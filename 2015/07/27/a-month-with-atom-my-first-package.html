<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Massimo Ronca ~ a reckless programmer with a sarcastic wit - A month with Atom: my first package</title>

    

    
    <meta name="description" content="Welcome to Massimo Ronca website, this post is about: Atom, Atom Package, Atom Editor, Coffeescript">
    

    <link rel="stylesheet" href="/assets/stylesheets/fonts.css">
    <link rel="stylesheet" href="/assets/stylesheets/styles.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="/assets/stylesheets/solarized-dark.css">
    <script src="/assets/javascripts/highlight.pack.js"></script>

    <link href="" rel="alternate" type="application/rss+xml" title="Massimo Ronca ~ a reckless programmer with a sarcastic wit" />

    <link rel="icon" type="image/png" href="/assets/images/icon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    

    <meta name="og:title" content="A month with Atom: my first package">
    <meta name="og:type" content="website">
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header-title"><a href="/">Massimo Ronca</a></h1>

        <img src="/assets/images/massimoronca.png" class="logo" alt="Massimo Ronca">
        <p>This is not</p>
        <p>the programmer</p>
        <p>you're looking for</p>

     <footer>
       <a href="https://github.com/wstucco" title="Github"><img src="/assets/images/github-64.png" alt="Github" class="github-logo"> </a>
       <a href="https://twitter.com/wstucco" title="Twitter"><img src="/assets/images/twitter-64.png" alt="Twitter" class="twitter-logo"> </a>
       <a href="https://it.linkedin.com/in/massimoronca" title="Linkedin"><img src="/assets/images/linkedin-64.png" alt="Linkedin" class="linkedin-logo"> </a>
      </footer>
    </header>


  <section>
  <article id="content" class="post">
  <h1 class="post-title">A month with Atom: my first package</h1>
  <div class="post-content">
    <p>Exactly one month ago, Github relaesed version 1.0 of their open source editor Atom.
 Giovanni <a href="http://dev.mikamai.com/post/122755410549/a-month-long-atom-test-drive-from-an-emacs-fanatic">already blogged</a> <a href="http://dev.mikamai.com/post/124331931184/atom-18-days-in">about it</a>, from the perspective of a long time Emacs lover: Atom still has a long way to go, but he also admitted that</p>

<blockquote>
<p>There are several things going for Atom though. Coffeescript is a more popular language than Lisp, also, I know it better, so writing my own Atom extensions wonâ€™t be as hard as writing my Emacs extensions.</p>
</blockquote>

<p>I&rsquo;ve never been proficient enough with Lisp to write a package for Emacs, and Vimscript is really too hackish for the undisciplined developer I am.<br />
I know Javascript better, but I don&rsquo;t love it.<br />
Atom packages can be written in Coffeescript, a language that I really enjoy.<br />
Language alone is surely not enough to declare that writing a package is going to be easy, but it gave me the confidence to try.</p>

<p>Our package will be very simple: it will put a live clock on the right side of the status bar that can be toggled on and off.</p>

<p>To begin, we create a <code>status-bar-clock</code> folder inside <code>~/.atom/packages/</code> and add a <code>package.json</code>, in the same way we dot for regular node packages.<br />
Atom added a <a href="https://atom.io/docs/v0.186.0/creating-a-package#packagejson">few unique keys</a>, where <code>main</code> is the only one required and points to the entry point of our package.</p>

<p>The base version of our <code>package.json</code> will look like this</p>

<pre><code class="language-json">{
  &quot;name&quot;: &quot;status-bar-clock&quot;,
  &quot;main&quot;: &quot;./lib/status-bar-clock&quot;,
  &quot;version&quot;: &quot;0.0.1&quot;,
  &quot;description&quot;: &quot;Show a clock inside the status bar&quot;,
  &quot;repository&quot;: &quot;https://github.com/wstucco/status-bar-clock&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;engines&quot;: {
    &quot;atom&quot;: &quot;&gt;=1.0.0 &lt;2.0.0&quot;
  }
}

</code></pre>

<p>Then we create the package main and put it in <code>lib/ststus-bar-clock.coffee</code>.<br />
Atom packages are simple objects that implement the two methods <code>activate</code> and <code>deactivate</code>; only <code>activate</code> is required, <code>deactivate</code> is called when the package is removed or deactivated from the preferences and is useful to clean up: in OO terms it&rsquo;s the destructor.</p>

<p>We&rsquo;ll start with the most basic package possible</p>

<pre><code class="language-coffeescript">module.exports = StatusBarClock =
  activate: (state) -&gt;
    console.log 'Clock was activated'
  deactivate: -&gt;
    console.log 'Clock was deactivated'
</code></pre>

<p>Save it and press <code>ctrl-alt-cmd-l</code>, it will reload the editor, including our package code. If you open up the developer tools with <code>cmd-alt-i</code> you should see the message <code>Clock was activated</code> in the console.<br />
If you disable the package from the preferences, the message <code>Clock was deactivated</code> will show up.<br />
We&rsquo;re in business!</p>

<p>Enabling and disabling the package from the preferences is not very convenient, moreover it&rsquo;s not what we really want, we just want to toggle the clock on or off, without having to disable the entire package.<br />
We&rsquo;ll add a keyboard shortcut, <code>keymaps</code> in Atom: keymaps are <code>json</code> or <code>cson</code> files inside the <code>keymaps</code> folder (for documentation <a href="https://atom.io/docs/latest/behind-atom-keymaps-in-depth">see here</a>).
We bind the toggle command to <code>ctrl-alt-t</code> (the same action should be present in the action menu if you press <code>cmd-shift-p</code>)</p>

<pre><code class="language-coffeescript"># keymaps/status-bar-clock.cson
'atom-workspace':
  'ctrl-alt-t': 'status-bar-clock:toggle'
</code></pre>

<p>Once we declared the mapping between keys and commands, we write the code to handle it.</p>

<blockquote>
<p>note: the binding will only work if we are inside the Atom workspace, so if, for example, the developer console has the focus, the binding won&rsquo;t work</p>
</blockquote>

<pre><code class="language-coffeescript">{CompositeDisposable} = require 'atom'

module.exports = StatusBarClock =
  active: false

  activate: (state) -&gt;
    @subscriptions = new CompositeDisposable
    # Register command that toggles this view
    @subscriptions.add atom.commands.add 'atom-workspace', 'status-bar-clock:toggle': =&gt; @toggle()

    console.log 'Clock was activated'
  deactivate: -&gt;
    console.log 'Clock was deactivated'

  toggle: -&gt;
    console.log 'Clock was toggled on' if @active
    console.log 'Clock was toggled off' if !@active

    @active = ! !!@active
</code></pre>

<p>Now we need to add the message to the status bar, the status bar in Atom is a <code>service</code> and exposes an API that can be consumed.<br />
We declare this dependency in <code>package.json</code></p>

<pre><code class="language-json">  &quot;consumedServices&quot;: {
    &quot;status-bar&quot;: {
      &quot;versions&quot;: {
        &quot;^1.0.0&quot;: &quot;consumeStatusBar&quot;
      }
    }
  }
</code></pre>

<p>When the status bar is initialized, it will call a method in our package, passing an instance of itself as parameter.<br />
Status bar API docs can be found <a href="https://github.com/atom/status-bar">here</a></p>

<pre><code class="language-coffeescript">
consumeStatusBar: (statusBar) -&gt;
  @statusBar = statusBar

</code></pre>

<p>Status bar can display different blocks called <code>titles</code> on the left and right side. The displayed element must be a view which <em>&ldquo;can be a DOM element, a jQuery object, or a model object for which a view provider has been registered in the <a href="https://atom.io/docs/api/v1.0.2/ViewRegistry">view registry</a>&ldquo;</em><br />
We&rsquo;re going the simple route and create a DOM element</p>

<pre><code class="language-coffeescript">class StatusBarClockView extends HTMLElement
  init: -&gt;
    @classList.add('status-bar-clock', 'inline-block')
    @activate()

  activate: -&gt;
    @intervalId = setInterval @updateClock.bind(@), 100

  deactivate: -&gt;
    clearInterval @intervalId

  getTime: -&gt;
    date = new Date

    seconds = date.getSeconds()
    minutes = date.getMinutes()
    hour = date.getHours()

    minutes = '0' + minutes if minutes &lt; 10
    seconds = '0' + seconds if seconds &lt; 10

    &quot;#{hour}:#{minutes}:#{seconds}&quot;

  updateClock: -&gt;
    @textContent = @getTime()

module.exports = document.registerElement 'status-bar-clock',
  prototype: StatusBarClockView.prototype, extends: 'div'

</code></pre>

<p>and display it</p>

<pre><code class="language-coffeescript">{CompositeDisposable} = require 'atom'
StatusBarClockView = require './status-bar-clock-view'

module.exports = StatusBarClock =
  active: false

  activate: (state) -&gt;
    console.log 'Clock was activated'

    @subscriptions = new CompositeDisposable
    # Register command that toggles this view
    @subscriptions.add atom.commands.add 'atom-workspace',     'status-bar-clock:toggle': =&gt; @toggle()

    @statusBarClockView = new StatusBarClockView()
    @statusBarClockView.init()

  deactivate: -&gt;
    console.log 'Clock was deactivated'
    @subscriptions.dispose()
    @statusBarClockView.destroy()
    @statusBarTile?.destroy()

  toggle: -&gt;
    if @active
      @statusBarTile.destroy()
      @statusBarClockView.deactivate()
    else
      console.log 'Clock was toggled on'
      @statusBarClockView.activate()
      @statusBarTile = @statusBar.addRightTile
        item: @statusBarClockView, priority: -1

    @active = ! !!@active

  consumeStatusBar: (statusBar) -&gt;
    @statusBar = statusBar
    # auto activate as soon as status bar activates
    @toggle()
</code></pre>

<p>Last we add a submenu inside the <code>Package</code> menu that executes the toggle command.<br />
Create a <code>menus/status-bar-clock.cson</code> and add</p>

<pre><code class="language-coffeescript">
# See https://atom.io/docs/latest/hacking-atom-package-word-count#menus for more details
'menu': [
  {
    'label': 'Packages'
    'submenu': [
      'label': 'Clock'
      'submenu': [
        {
          'label': 'Toggle'
          'command': 'status-bar-clock:toggle'
        }
      ]
    ]
  }
]

</code></pre>

<p>Reload. The clock should be there at the bottom right, updating itself.<br />
You can find the source code on <a href="https://github.com/wstucco/status-bar-">GitHub</a> and the final package on <a href="https://atom.io/packages/status-bar-clock">atom.io</a>.</p>

  </div>
  <div class='small post-meta'>
    posted 
    on Monday, Jul 27 2015
  </div>
</article>

  </section>


    </div>
    <script src="/assets/javascripts/scale.fix.js"></script>
    <script src="/assets/javascripts/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1218157-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>